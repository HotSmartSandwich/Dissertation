\chapter{Программы работы робота}
В ходе выполнения работы, были рассмотрены различные варианты управления промышленным роботом-манипулятором.
В связи с проприетарностью встроенного программного обеспечения, при разработке информационно-управляющей системы было возможно использовать только ограниченный функционал, предлагаемый производителем оборудования.


\section{Основные способы создания программ}
Базовым и наиболее распространённым в промышленности способом является программирование напрямую через пульт управления (Teach Pendant).
Оператор вручную задаёт координаты каждой точки и ориентацию рабочего инструмента робота, либо сохраняет их в режиме обучения.
Главным преимуществом такого подхода является простота и относительно высокая скорость написания простых программ работы.
Однако, он категорически не подходит для задания более сложных траекторий, какой и является траектория наплавки.

Для написания программ, описывающих сложные траектории движения существуют различные CAD/CAM системы, единственным значимым недостатком которых является высокая стоимость и строго ограниченный инструментарий.
Сами же сгенерированные траектории движения представляют из себя массивы из множества точек.

Изучив возможность самостоятельного написания и загрузки программ работы робота в контроллер, было принято решение спроектировать и разработать собственное приложение, включающее в себя пользовательский графический интерфейс для создания и редактирования траекторий наплавки и постпроцессор -- программное обеспечение, позволяющее преобразовать заданную оператором траекторию в программу работы для контроллера робота.
Похожий подход был применён в работе~\cite{Nagata_2017}, но в ней рассматривается исключительно интерполяция уже готового набора данных дугами.


\section{Структура программ работы} \label{sec:ProgramStructure}
Основные расширения файлов программ, с которыми работают контроллеры FANUC -- это <<.LS>> и <<.TP>>.

Файл с расширением <<.LS>> -- это листинг программы, текстовый файл с ASCII кодировкой, для открытия и редактирования которого может быть использован любой текстовый редактор.
Представляет из себя два основных блока: блок движений <</MN>>, описывающий все действия робота в виде инструкций, и блок позиций <</POS>>, в котором находится информация о координатах всех точек, используемых в программе.
Пример оформления и синтаксиса приведён в листинге~\ref{lst:LS-Example}.

\begin{lstlisting}[caption={Пример оформления .LS файлов}, label={lst:LS-Example}]
	/PROG EXAMPLE.LS

	/ATTR

	/MN
	:J P[1] 10% FINE;
	:  WAIT 1.5(sec);
	:L P[2] 250mm/sec CNT50;
	:L P[3] 4sec CNT100;
	:J P[1] 5% FINE;

	/POS
	P[1]{
		GP1:
		UF: 1, UT: 1,	CONFIG: 'N U T, 0, 0, 0',
		X = 729.8 mm,	Y = 134.9 mm,	Z = 181.1 mm,
		W = 191.2 deg,	P = 13.3 deg,	R = 14.2 deg
	};

	P[2]{
		GP1:
		UF: 1, UT: 1,	CONFIG: 'N U T, 0, 0, 0',
		X = 693.6 mm,	Y = 695.6 mm,	Z = 0.0 mm,
		W = 120.0 deg,	P = -9.9 deg,	R = -46.8 deg
	};

	P[3]{
		GP1:
		UF: 1, UT: 1,	CONFIG: 'N U T, 0, 0, 0',
		X = 512.9 mm,	Y = 129.8 mm,	Z = -31.5 mm,
		W = 191.5 deg,	P = 43.1 deg,	R = 45.1 deg
	};

	/END
\end{lstlisting}

Файл с расширением <<.TP>> -- это скомпилированная программа в виде байт-кода.
Старые контроллеры FANUC не имеют пакета расширения <<ASCII Upload>>, позволяющего компилировать файлы с расширением <<.LS>> при их загрузке в контроллер.
Поэтому они должны быть скомпилированы предварительно.
Компиляция выполняется при помощи пакета программ FANUC WinOLPC .


\section{Конфигурация робота} \label{sec:RobotConfiguration}
Для роботов FANUC целевая точка может задаваться двумя способами.

Первый способ -- через задание углов поворота каждого сочленения робота ($J_1$, $J_2$, $J_3$, $J_4$, $J_5$, $J_6$).
Пример задания целевой точки этим способом приведён в листинге~\ref{lst:J16-TargetPoint}.

\begin{lstlisting}[caption={Задание целевой точки с помощью углов J1-J6}, label={lst:J16-TargetPoint}]
	P[1]{
		UF : 1, UT : 1,
		J1 =   49.399 deg,    J2 =   10.072 deg,    J3 =  -24.105 deg,
		J4 =    -.000 deg,    J5 =  -65.895 deg,    J6 =   40.601 deg
	};
\end{lstlisting}

Второй способ -- через шесть координат, три из которых определяют положение целевой точки (X, Y, Z), а другие три -- ориентацию рабочего инструмента в абсолютной системе координат, связанной с основанием робота (W, P, R).
Пример задания целевой точки приведён в листинге~\ref{lst:XYZWPR-TargetPoint}.

\begin{lstlisting}[caption={Задание целевой точки с помощью координат XYZWPR}, label={lst:XYZWPR-TargetPoint}]
	P[1]{
		UF : 1, UT : 1,        CONFIG : 'N U T, 0, 0, 0',
		X =   750.000  mm,    Y =   800.000  mm,    Z =   225.000  mm,
		W =   180.000 deg,    P =     0.000 deg,    R =    90.000 deg
	};
\end{lstlisting}

Этот способ задания является наиболее удобным и информативным для оператора, так как ссылается на понятные человеку пространственные координаты.
Однако, он не является однозначным: в одной и той же точке, с одной и той же ориентацией рабочего инструмента, робот может находиться несколькими способами, пример чего приведён на рисунке~\ref{fig:RobotConfiguration}.

\begin{figure}[H]
    \centering
    \vspace{14pt}
    \includegraphics[width=\linewidth]{Figures/Software/RobotConfiguration}
    \caption{Разная конфигурация робота в одной и той же целевой точке}
    \label{fig:RobotConfiguration}
\end{figure}

Конкретная конфигурация робота задаётся для каждой точки отдельно при помощи параметра <<CONFIG>> (листинг~\ref{lst:XYZWPR-TargetPoint}).

Параметр <<CONFIG>> для роботов FANUC с кинематической схемой <<Puma>> состоит из трёх буквенных и трёх численных обозначений.
Буквенные обозначения позволяют однозначно определить положение звеньев робота.
Расшифровка буквенных обозначений приведена в таблице~\ref{tab:RobotConfig}.

\begin{table}[H]
    \caption{Расшифровка буквенных обозначений}
    \label{tab:RobotConfig}
    \begin{tabular}{|p{0.26\linewidth}|p{0.26\linewidth}|p{0.4\linewidth}|}
        \hline
        Обозначение & Расшифровка   & Значение                \\ \hline
        N           & wrist No-flip & запястье не перевёрнуто \\ \hline
        F           & wrist Flip    & запястье перевёрнуто    \\ \hline
        U           & elbow Up      & локоть вверх            \\ \hline
        D           & elbow Down    & локоть вниз             \\ \hline
        T           & config Top    & подход спереди          \\ \hline
        B           & config Bottom & подход сзади            \\ \hline
    \end{tabular}
\end{table}

Большая часть приведённых конфигураций является экзотической.
Как правило, в работе используется конфигурация <<NUT>> и в ходе выполнения программы она не изменяется.

Численные обозначения указывают на количество полных оборотов сверх необходимого угла поворота для многооборотных сочленений.
Как правило, количество полных оборотов необходимо учитывать при задании таких траекторий, когда происходит перекручивание запястья робота.

При работе со сварочной горелкой, кабель которой закреплён не в полом запястье робота, а снаружи, такие перекручивания недопустимы, потому в дальнейшей работе конфигурация <<N U T, 0, 0, 0>> принимается постоянной и неизменяемой.
