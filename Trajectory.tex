\chapter{Генерация траекторий}


\section{Параметры траектории движения} \label{sec:TrajectoryParameters}
В технологических процессах, связанных с операциями сварки и наплавки, как правило, определяются лишь основные сварочные параметры: вид сварки, присадочный материал, режимы работы сварочного аппарата.
В случае наплавки также указывается частота и амплитуда колебаний.
Но почти никогда не даётся рекомендаций касательно выбора типа сварочных колебаний.
Выбор конкретного паттерна колебаний чаще всего остаётся непосредственно за сварщиком, что приводит к ещё большему увеличению в разбросе качества конечной продукции.

Рассматриваемые в подразделе~\ref{subsec:WeldingMachines} установки для наплавки, как правило, реализуют только зигзагообразные колебания.
Решения для роботизированной сварки/наплавки, как, например, FANUC ArcTool и KUKA.ArcTech предлагают готовый инструментарий для задания сварочной траектории с колебаниями лишь из узкого набора предустановленных паттернов с ограниченной возможностью их параметрического редактирования.

Для того чтобы проследить влияние выбранного типа колебаний и их конкретных параметров на качество конечной продукции, в рамках этой работы был разработан программный модуль, позволяющий универсальным способом задавать траекторию движения сварочной горелки с независимым наложением на неё колебаний разных типов.


\section{Создание траектории движения}
Траектория движения сварочной горели строится на основании двух составляющих: путь и накладываемые на него колебания.
При создания траектории движения, сначала выбирается тип пути.
После, задаётся тип колебаний и их основные параметры, прописанные в технологическом процессе для конкретного изделия.

Так как технологический процесс разработан для наплавки вручную, то все эти параметры указываются в виде допустимого диапазона с учётом возможных неточностей в работе сварщика.
В случае роботизированной наплавки, конкретные значения параметров выбираются из диапазона оператором исходя из внешнего вида предполагаемой траектории.

Как было описано в подразделе~\ref{sec:ProgramStructure}, на контроллер робота программа работы передаётся в виде набора инструкций и используемых в программе положений.
Таким образом, траектория движения робота представляется в виде набора точек.
Количество точек напрямую зависит от параметров конкретной траектории и должно подбираться оператором исходя из её внешнего вида.

Для более простых траекторий с небольшим итоговым числом колебаний, количество точек может быть значительно меньше, чем для более сложных траекторий.
Недостаточное количество точек может привести к значительному снижению точности движения по траектории.
Чрезмерно завышенное число точек, в свою очередь, существенно сказывается на времени компиляции и загрузки программы работы.
К тому же, более старые версии контроллеров не всегда справляются с обработкой программ работы большого объёма.
Пример внешнего вида одной и той же траектории при разном количестве точек приведён на рисунке~\ref{fig:LowPointTrajectoryExample}.

\begin{figure}[H]
    \centering
    \vspace{14pt}
    \includegraphics[width=\linewidth]{Figures/Software/LowPointTrajectoryExample}
    \caption{Траектория при разном количестве точек}
    \label{fig:LowPointTrajectoryExample}
\end{figure}

Для того, чтобы иметь возможность менять количество точек в траектории, сама траектория должна описываться в параметрическом виде, где координаты каждой точки зависят от некоторого параметра $t$.
Величина шага изменения этого параметра и будет влиять на количество точек.

Как было указано в разделе~\ref{sec:TrajectoryParameters}, траектория движения состоит из основного пути движения и наложенных на него колебаний.
И основной путь, и колебания представляют собой набор точек.

Для примера, рассмотрим траекторию, приведённую на рисунке~\ref{fig:LowPointTrajectoryExample}.
Это траектория движения по окружности с круговые колебания.

Сперва, вычисляется массив точек, из которых состоит основная траектория:

\begin{gather*}
    \begin{cases}
        \begin{aligned}
            x_p = \dfrac{D}{2} \cdot \cos t \\
            \\
            y_p = \dfrac{D}{2} \cdot \sin t
        \end{aligned}
    \end{cases}, \\
    0 \leq t \leq 2 \pi,
\end{gather*} \\
где $D$ -- диаметр окружности.

Для корректной генерации колебаний, для начала необходимо вычислить общее количество колебаний, которое зависит от частоты колебаний, протяжённости выбранного пути и скорости перемещения:

\begin{equation*}
    F_N = \dfrac{2 \pi \cdot D}{S} \cdot F,
\end{equation*} \\
где $S$ -- скорость движения по траектории, $F$ -- частота колебаний.

Вычисление точек колебаний осуществляется следующим образом:

\begin{gather}
    \begin{cases}
        \label{eq:OscillationCircle}
        \begin{aligned}
            x_o = \dfrac{A_w}{2} \cdot \sin t \\
            \\
            y_o = \dfrac{A_h}{2} \cdot \cos t
        \end{aligned}
    \end{cases}, \\
    \nonumber
    0 \leq t \leq 2 \pi \cdot F_N,
\end{gather} \\
где $A_w$ -- амплитуда колебаний по ширине, $A_h$ -- амплитуда колебаний по высоте.

Для каждой точки траектории рассчитывается угол поворота колебания:

\begin{equation*}
    a_i = \arctan \dfrac{{y_p}_i - {y_p}_{i-1}}{{x_p}_i - {x_p}_{i-1}},
\end{equation*} \\
где $1 \leq i \leq F_N$ -- номер точки траектории.

Точки колебаний поворачиваются на соответствующий номеру координаты угол.
После чего, координаты повёрнутых точек складываются с координатами основного пути движения:

\begin{gather*}
    \begin{bmatrix}
    {x_t}
        _i \\
        {y_t}_i
    \end{bmatrix} =
    \begin{bmatrix}
    {x_p}
        _i \\
        {y_p}_i
    \end{bmatrix} +
    \begin{bmatrix}
        \cos a_i & - \sin a_i \\
        \sin a_i & \cos a_i
    \end{bmatrix}
    \begin{bmatrix}
    {x_o}
        _i \\
        {y_o}_i
    \end{bmatrix}.
\end{gather*} \\

Таким образом происходит наложение колебаний на основной путь движения, что позволяет получить итоговую траекторию движения.

Важной особенностью разработанного алгоритма является его универсальность для разных типов колебаний.
При добавлении колебаний нового типа, достаточно описать их в параметрической форме, подобной уравнению~\ref{eq:OscillationCircle}.
Например, параметрическая форма для колебаний восьмёркой, представленных на рисунке~\ref{fig:OscillationEight}, имеет следующий вид:

\begin{gather*}
    \begin{cases}
        \begin{aligned}
            &x_o = \dfrac{\dfrac{A_w}{2} \cdot \sin t \cos t}{1 + \sin^2 t} \\
            \\
            &y_o = \dfrac{\dfrac{A_h}{2} \cdot \cos t}{1 + \sin^2 t}
        \end{aligned}
    \end{cases}, \\
    0 \leq t \leq 2 \pi \cdot F_N,
\end{gather*} \\

\begin{figure}[H]
    \centering
    \vspace{14pt}
    \includegraphics[height=15cm]{Figures/Software/OscillationEight}
    \caption{Пример траектории движения по окружности с колебаниями восьмёркой}
    \label{fig:OscillationEight}
\end{figure}